// AR9331自定义设备树补丁
// 适用于64MB DDR2，16MB SPI flash，单网口配置

/ {
    compatible = "qca,ar9331";

    memory@0 {
        device_type = "memory";
        reg = <0x0 0x4000000>;  // 64MB内存
    };

    chosen {
        bootargs = "console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd";
    };

    leds {
        compatible = "gpio-leds";

        // 系统状态LED（通常连接到GPIO0）
        sys_led: sys {
            label = "ar9331:green:sys";
            gpios = <&gpio 0 GPIO_ACTIVE_LOW>;
            default-state = "on";
            linux,default-trigger = "heartbeat";
        };

        // 无线状态LED（通常连接到GPIO1）
        wlan_led: wlan {
            label = "ar9331:green:wlan";
            gpios = <&gpio 1 GPIO_ACTIVE_LOW>;
            default-state = "off";
            linux,default-trigger = "phy0tpt";
        };
    };

    gpio-keys {
        compatible = "gpio-keys";

        reset {
            label = "reset";
            linux,code = <KEY_RESTART>;
            gpios = <&gpio 11 GPIO_ACTIVE_LOW>;  // 复位按钮GPIO
            debounce-interval = <60>;
        };
    };
};

&spi {
    status = "okay";
    num-cs = <1>;

    flash@0 {
        compatible = "jedec,spi-nor";
        reg = <0>;
        spi-max-frequency = <25000000>;

        partitions {
            compatible = "fixed-partitions";
            #address-cells = <1>;
            #size-cells = <1>;

            uboot: partition@0 {
                label = "u-boot";
                reg = <0x0 0x20000>;
                read-only;
            };

            u-boot-env: partition@20000 {
                label = "u-boot-env";
                reg = <0x20000 0x10000>;
                read-only;
            };

            firmware: partition@30000 {
                label = "firmware";
                reg = <0x30000 0xfd0000>;
            };

            art: partition@1000000 {
                label = "art";
                reg = <0x1000000 0x10000>;
                read-only;
            };
        };
    };
};

&eth0 {
    status = "okay";
    phy-handle = <&phy0>;
    phy-mode = "mii";

    fixed-link {
        speed = <100>;
        full-duplex;
    };
};

&mdio0 {
    phy0: ethernet-phy@0 {
        reg = <0>;
    };
};

&wmac {
    status = "okay";
    qca,no-eeprom;
};
